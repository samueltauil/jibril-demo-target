# Alchemy: Forward credential file access events to the correlation agent.
# Triggered by: Scenarios 1 (credential-theft), 3 (container-breakout)
# Matches chain step: credential_access

- kind: credentials_files_access
  name: forward_credential_access
  enabled: true
  version: 1.0
  description: "Forward credential file access events to the correlation agent"
  breed: file_access
  mechanism: file_access
  tactic: credential_access
  technique: unsecured_credentials
  subtechnique: none
  importance: critical
  severity_level: critical
  severity: 85
  confidence: 0.78
  times:
    - kind: times_per_proc
      max: 2
    - kind: times_per_exe
      max: 4
    - kind: times_per_full_ancestry
      max: 4
  arbitrary: []
  file_actions:
    - read
    - access_related
  file_actions_how: any
  bases:
    - dir: /etc
      base: shadow
    - dir: /etc
      base: gshadow

  reactions:
    - format: shell
      code: |
        curl -sf -X POST -H "Content-Type: application/json" -d "$REACTION_DATA" ${AGENT_URL:-http://localhost:3000}/events || true
